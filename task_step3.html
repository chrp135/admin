<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="static/js/layui/css/layui.css">
    <link rel="stylesheet" href="static/css/admin.css">
    <title>旅业盒子</title>
</head>

<body>
    <div class="header-con flex-box">
        <div class="logo">
            <img src="static/img/logo.png">
        </div>
        <div class="lxs layui-nav">
            <div class="lxs-name"><i class="iconfont icon-qiye"></i>厦门宝中旅行社</div>
            <div class="layui-nav-item c-blue">
                <a href="javascript:;" class="">切换</a>
                <dl class="layui-nav-child">
                    <dd><a href="">选项1</a></dd>
                    <dd><a href="">选项2</a></dd>
                    <dd><a href="">选项3</a></dd>
                </dl>
            </div>
        </div>
        <div class="login-status layui-nav">
            <div class="layui-nav-item">
                <a href="javascript:;">欢迎您，陈明明</a>
                <dl class="layui-nav-child">
                    <dd><a href="javascript:;">选项1</a></dd>
                    <dd><a href="javascript:;">选项2</a></dd>
                    <dd><a href="javascript:;">选项3</a></dd>
                </dl>
            </div>
        </div>
    </div>
    <div class="left-con">
        <div class="scroll-con">
                <dl>
                    <dt>
                        <a href="javascript:;">
                            <i class="iconfont icon-shouye"></i>
                            <cite>首页</cite>
                        </a>
                    </dt>
                </dl>
                <dl class="open">
                    <dt href="javascript:;">
                        <i class="iconfont icon-renwuguanli"></i>
                        <cite>任务管理</cite>
                        <i class="iconfont icon-angle-down"></i>
                    </dt>
                    <dd>
                        <a href="" class="on">任务管理</a>
                        <a href="">申请开票</a>
                        <a href="">开票记录</a>
                        <a href="">完税凭证</a>
                    </dd>
                </dl>
                <dl>
                    <dt href="javascript:;">
                        <i class="iconfont icon-lingkeguanli"></i>
                        <cite>零客管理</cite>
                        <i class="iconfont icon-angle-down"></i>
                    </dt>
                    <dd>
                        <a href="">采购订单</a>
                        <a href="">分销订单</a>
                        <a href="">保险订单</a>
                    </dd>
                </dl>
                <dl>
                    <dt href="javascript:;">
                        <i class="iconfont icon-fuwushang"></i>
                        <cite>服务商</cite>
                        <i class="iconfont icon-angle-down"></i>
                    </dt>
                    <dd>
                        <a href="">邀请分销商</a>
                    </dd>
                </dl>
                <dl>
                    <dt href="javascript:;">
                        <i class="iconfont icon-caiwu1"></i>
                        <cite>财务</cite>
                        <i class="iconfont icon-angle-down"></i>
                    </dt>
                    <dd>
                        <a href="">资金管理</a>
                        <a href="">提现申请</a>
                        <a href="">发票管理</a>
                    </dd>
                </dl>
                <dl>
                    <dt href="javascript:;">
                        <i class="iconfont icon-shezhi"></i>
                        <cite>设置</cite>
                        <i class="iconfont icon-angle-down"></i>
                    </dt>
                    <dd>
                        <a href="">常用信息</a>
                        <a href="">账号信息</a>
                        <a href="">修改密码</a>
                    </dd>
                </dl>
        </div>
        <a href="javascript:;" class="btn-side J-btn-side"><i class="iconfont icon-left"></i></a>
    </div>
    <div class="body-con layui-form">
        <div class="body-wrap">
            <div class="ndwz">
                首页 > <a href="">任务管理</a>
            </div>
            <div class="ui-tag-tit">
                <ul>
                    <li><a href="javascript:;" class="on">发布任务</a></li>
                </ul>
            </div>
            <div class="layui-card pd-20">
                <div class="layui-card-body">
                    <div class="step-con vh80">
                        <ul>
                            <li class="on"><sub></sub><span>选择服务商</span></li>
                            <li class="on"><sub></sub><span>项目任务配置</span></li>
                            <li class="on current"><sub></sub><span>邀请零客</span></li>
                            <li><sub></sub><span>确定发布</span></li>
                        </ul>
                    </div>
                    
                    <div class="layui-row layui-col-space20 mg-t-20">
                        <div class="layui-col-xs5">
                            <div class="ui-tit">
                                <b>选择零客</b>
                            </div>
                            <div class="mod-filter">
                                <div class="layui-input-inline ui-w120">
                                    <select name="" class="" lay-filter="">
                                        <option value="" selected="">选项分组</option>
                                        <option value="1">终保日期</option>
                                    </select>
                                </div>
                                <div class="layui-input-inline">
                                    <input type="text" name="keyword" value="" placeholder="姓名/手机号/证件号" autocomplete="off" class="layui-input ui-w200">
                                </div>
                                <div class="layui-input-inline">
                                    <a href="javascript:;" class="layui-btn">搜索</a>
                                    <a href="javascript:;" class="layui-btn J-test-data">测试数据</a>
                                </div>
                            </div>
                            <table class="layui-table mg-t-10" lay-filter="table-list">
                                <thead>
                                    <tr>
                                        <th width="50">
                                            <input type="checkbox" name="checkboxAll1" class="J-check-all" lay-filter="checkboxAll1" lay-skin="primary" title="全选">
                                        </th>
                                        <th width="100">姓名</th>
                                        <th width="120">手机号</th>
                                        <th width="">证件号</th>
                                    </tr>
                                </thead>
                                <tbody class="checkbox-left">
                                    <tr data-id="35021219901206051" data-rate="10">
                                        <td><input type="checkbox" name="check1" class="J-check-item" lay-filter="check1" value="1" lay-skin="primary" title=""></td>
                                        <td>陈敏敏</td>
                                        <td>15966055220</td>
                                        <td>35021219901206051</td>
                                    </tr>
                                    <tr data-id="35021219901206052" data-rate="20">
                                        <td><input type="checkbox" name="check1" class="J-check-item" lay-filter="check1" value="2" lay-skin="primary" title=""></td>
                                        <td>陈敏敏</td>
                                        <td>15966055220</td>
                                        <td>35021219901206052</td>
                                    </tr>
                                    <tr data-id="35021219901206053" data-rate="30">
                                        <td><input type="checkbox" name="check1" class="J-check-item" lay-filter="check1" value="3" lay-skin="primary" title=""></td>
                                        <td>陈敏敏</td>
                                        <td>15966055220</td>
                                        <td>35021219901206053</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="layui-col-xs7 bg-blueRgb">
                            <div class="ui-tit">
                                <b>已选零客</b>
                            </div>
                            <div class="mod-filter">
                                <div class="layui-input-inline">
                                    <input type="text" name="keyword-right" value="" placeholder="姓名/手机号/证件号" autocomplete="off" class="layui-input ui-w200">
                                </div>
                                <div class="layui-input-inline">
                                    <a href="javascript:;" class="layui-btn J-search-right">搜索</a>
                                    <a href="javascript:;" class="layui-btn J-del-all">批量删除</a>
                                </div>
                            </div>
                            <table class="layui-table mg-t-10" lay-filter="table-list">
                                <thead>
                                    <tr>
                                        <th width="50">
                                            <input type="checkbox" name="checkboxAll2" class="J-check-all" lay-filter="checkboxAll2" lay-skin="primary" title="全选">
                                        </th>
                                        <th width="100">姓名</th>
                                        <th width="120">手机号</th>
                                        <th width="">证件号</th>
                                        <th width="80">任务佣金</th>
                                        <th width="50"><a href="javascript:;" class="layui-btn btn-xs plain J-current input-l">切换</a></th>
                                        <th width="80" class="text-r">预计收入</th>
                                    </tr>
                                </thead>
                                <tbody class="checkbox-right">
                                    <!-- <tr>
                                        <td><input type="checkbox" name="check2" class="J-check-item" lay-filter="check2" value="1" lay-skin="primary" title=""></td>
                                        <td>陈敏敏</td>
                                        <td>15966055220</td>
                                        <td>35021219901206056</td>
                                        <td><input type="text" name="keyword" value="" placeholder="请输入" autocomplete="off" class="layui-input ui-w200"></td>
                                        <td class="text-r">0.00</td>
                                    </tr> -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                </div>
                <div class="sticky-bottom mg-t-20">
                    <a href="javascript:;" class="layui-btn btn-lg plain">取消</a>
                    <a href="javascript:;" class="layui-btn btn-lg btn-normal J-btn-next">下一步</a>
                </div>
            </div>
            
            <!-- <div class="footer-btn">
                <a href="" class="layui-btn btn-lg plain">取消</a>
                <a href="" class="layui-btn btn-lg btn-normal">确认完成</a>
            </div> -->
        </div>
        <!-- <div class="footer-con">
            &copy; Copyright 2020 多多优采&emsp;|&emsp;技术支持：<a>厦门市旅动力信息有限公司</a>
        </div> -->
    </div>

<script type="text/html" id="tpl-detail-con">
    <div class="txt">
        <p>为商业地产租赁及物业行业提供家政、经纪代理、软件技术服务及匹配的相关装卸搬运、会议会展、企业管理服务内容</p>
        <p>为商业地产租赁及物业行业提供家政、经纪代理、软件技术服务及匹配的相关装卸搬运、会议会展、企业管理服务内容</p>
        <p>为商业地产租赁及物业行业提供家政、经纪代理、软件技术服务及匹配的相关装卸搬运、会议会展、企业管理服务内容</p>
    </div>
</script>
<script src="static/js/layui/layui.js"></script>
<script src="static/js/layui/config.js"></script>
<!-- <script src="static/js/qrcode.min.js"></script> -->

<script>
    layui.use(['laydate', 'layer', 'table', 'form', 'upload', 'element', 'laytpl', 'tableNav'], function () {
        var $ = layui.jquery
            , laydate = layui.laydate //日期
            , layer = layui.layer //弹层
            , table = layui.table // 表格
            , form = layui.form //表单
            , upload = layui.upload
            , element = layui.element //元素操作
            , laytpl = layui.laytpl
            // , tableNav = layui.tableNav

        
        //全选
        form.on('checkbox(checkboxAll1)', function (data) {
            var table = $(data.elem).parents('.layui-table'),
            childs = table.find('.J-check-item');
            data.elem.checked ? childs.prop('checked', true) : childs.prop('checked', false);
            table.find('tr').addClass('on')

            checkBox()
            form.render();
        });

        form.on('checkbox(check1)', function (data) {
            var table = $(data.elem).parents('.layui-table'),
                checkall = table.find('.J-check-all'),
                check_item = table.find('.J-check-item'),
                item_len = check_item.length,
                check_len = table.find('.J-check-item:checked').length;

            console.log(data,item_len, check_len)
            item_len == check_len ? checkall.prop('checked', true) : checkall.prop('checked', false);

            checkBox()
            form.render();
        });

    


        //全选
        form.on('checkbox(checkboxAll2)', function (data) {
            var table = $(data.elem).parents('.layui-table'),
            childs = table.find('.J-check-item');
            data.elem.checked ? childs.prop('checked', true) : childs.prop('checked', false);
            table.find('tr').addClass('on')
            
            form.render();
        });

        form.on('checkbox(check2)', function (data) {
            var table = $(data.elem).parents('.layui-table'),
                checkall = table.find('.J-check-all'),
                check_item = table.find('.J-check-item'),
                item_len = check_item.length,
                check_len = table.find('.J-check-item:checked').length;
                
            // console.log(item_len, check_len)
            item_len == check_len ? checkall.prop('checked', true) : checkall.prop('checked', false);
            form.render();
        });

        $('body').on('click','.J-test-data',function(){
            var len = $('.checkbox-left tr').length+1
            var tr = `<tr data-id="3502121990120605`+len+`" data-rate="10">   
                    <td><input type="checkbox" name="check1" class="J-check-item" lay-filter="check1" value="1" lay-skin="primary" title=""></td>
                    <td>陈敏敏</td>
                    <td>15966055220</td>
                    <td>35021219901206051</td>
                </tr>`
            $('.checkbox-left').append(tr)
            form.render()
        })
        
        // 选择零客
        function checkBox(){
            // $('.checkbox-right').html('')
            $('input[name="check1"]').each(function(i,n) {
                var self = $(this),
                    tr = self.parents('tr'),
                    data_id = tr.attr('data-id'),
                    rate = tr.attr('data-rate'),
                    name = tr.find('td').eq(1).text(),
                    mobile = tr.find('td').eq(2).text(),
                    card = tr.find('td').eq(3).text()

                if(self.is(':checked')){
                    var html = `<tr class="`+data_id+`" data-id="`+data_id+`" data-rate="`+rate+`">
                                    <td><input type="checkbox" name="check2" class="J-check-item" lay-filter="check2" value="1" lay-skin="primary" title=""></td>
                                    <td>`+name+`</td>
                                    <td>`+mobile+`</td>
                                    <td>`+card+`</td>
                                    <td>
                                        <div class="num1 text-c layui-hide">0.00</div>
                                        <input type="text" name="" value="" placeholder="请输入" autocomplete="off" class="layui-input ui-w80 text-c J-commission1">
                                    </td>
                                    <td>&nbsp;</td>
                                    <td>
                                        <div class="num2 text-c">0.00</div>
                                        <input type="text" name="" value="" placeholder="请输入" autocomplete="off" class="layui-input ui-w80 text-c J-commission2 layui-hide">
                                    </td>
                                </tr>`

                    // var tr_html = tr.html().replace(/check1/g,'check2')
                    if($('.checkbox-right tr').length){
                        $('.checkbox-right tr[data-id="'+data_id+'"]')
                        if(!$('.checkbox-right tr').hasClass(data_id)){
                            $('.checkbox-right').append(html)
                        }
                    }else{
                        $('.checkbox-right').append(html)
                    }

                }else{
                    $('.checkbox-right').find('tr[data-id="'+data_id+'"]').remove()
                }
            });
        }

        $('body').on('click','.J-current',function(){
            var self = $(this),
                tbody = self.parents('table').find('tbody')
            if(self.hasClass('input-l')){
                self.removeClass('input-l')
                tbody.find('.num1').removeClass('layui-hide').siblings('input').addClass('layui-hide')
                tbody.find('.num2').addClass('layui-hide').siblings('input').removeClass('layui-hide')
                console.log(tbody.html());
            }else{
                self.addClass('input-l')
                tbody.find('.num2').removeClass('layui-hide').siblings('input').addClass('layui-hide')
                tbody.find('.num1').addClass('layui-hide').siblings('input').removeClass('layui-hide')
            }
        })

        $('body').on('blur','.J-commission1',function(){
            var self = $(this),
                val = self.val(),
                rate = self.parents('tr').attr('data-rate'),
                td = self.parents('tr').find('.num2'),
                count = Number(val*(100-rate)/100).toFixed(2)
            td.text(count)
        })


        $('body').on('blur','.J-commission2',function(){
            var self = $(this),
                val = self.val(),
                rate = self.parents('tr').attr('data-rate'),
                td = self.parents('tr').find('.num1'),
                count = Number(val*(100-rate)/100).toFixed(2)
            td.text(count)
        })


        // 搜索筛选
        $('body').on('click','.J-search-right',function(){
            var key_r = $('input[name="keyword-right"]').val()

            if(key_r == ''){
                $('.checkbox-right tr').show()
            }else{
                $('.checkbox-right tr').hide()
            }
            $('.checkbox-right tr').each(function(){
                var self = $(this),
                    str = self.find('td').eq(1).text().trim()+self.find('td').eq(2).text().trim()+self.find('td').eq(3).text().trim()
                var flag_num = str.indexOf(key_r)
                if(flag_num > 1){
                    $(this).show()
                }
            })
        })

        // 批量删除
        $('body').on('click','.J-del-all',function(){
            var arr_id = []
            $('input[name="check2"]:checked').each(function(i,n) {
                arr_id.push($(this).parents('tr').attr('data-id'))
                $(this).parents('tr').remove()
            });

            for(i in arr_id){
                console.log(i,arr_id[i]);
                $('.checkbox-left tr[data-id="'+arr_id[i]+'"]').find('.J-check-item').removeAttr('checked')
            }
            form.render();
        })
    


    })

</script>
</body>
</html>