<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="static/js/layui/css/layui.css">
    <link rel="stylesheet" href="static/css/admin.css">
    <title>旅业盒子</title>
</head>

<body>
    <div class="header-con flex-box">
        <div class="logo">
            <img src="static/img/logo.png">
        </div>
        <div class="lxs layui-nav">
            <div class="lxs-name"><i class="iconfont icon-qiye"></i>厦门宝中旅行社</div>
            <div class="layui-nav-item c-blue">
                <a href="javascript:;" class="">切换</a>
                <dl class="layui-nav-child">
                    <dd><a href="">选项1</a></dd>
                    <dd><a href="">选项2</a></dd>
                    <dd><a href="">选项3</a></dd>
                </dl>
            </div>
        </div>
        <div class="login-status layui-nav">
            <div class="layui-nav-item">
                <a href="javascript:;">欢迎您，陈明明</a>
                <dl class="layui-nav-child">
                    <dd><a href="">选项1</a></dd>
                    <dd><a href="">选项2</a></dd>
                    <dd><a href="">选项3</a></dd>
                </dl>
            </div>
        </div>
    </div>
    <div class="left-con">
        <div class="scroll-con">
            <dl>
                <dt>
                    <a href="javascript:;">
                        <i class="iconfont icon-shouye"></i>
                        <cite>首页</cite>
                    </a>
                </dt>
            </dl>
            <dl class="open">
                <dt href="javascript:;">
                    <i class="iconfont icon-renwuguanli"></i>
                    <cite>任务管理</cite>
                    <i class="iconfont icon-angle-down"></i>
                </dt>
                <dd>
                    <a href="" class="on">任务管理</a>
                    <a href="">申请开票</a>
                    <a href="">开票记录</a>
                    <a href="">完税凭证</a>
                </dd>
            </dl>
            <dl>
                <dt href="javascript:;">
                    <i class="iconfont icon-lingkeguanli"></i>
                    <cite>零客管理</cite>
                    <i class="iconfont icon-angle-down"></i>
                </dt>
                <dd>
                    <a href="">采购订单</a>
                    <a href="">分销订单</a>
                    <a href="">保险订单</a>
                </dd>
            </dl>
            <dl>
                <dt href="javascript:;">
                    <i class="iconfont icon-fuwushang"></i>
                    <cite>服务商</cite>
                    <i class="iconfont icon-angle-down"></i>
                </dt>
                <dd>
                    <a href="">邀请分销商</a>
                </dd>
            </dl>
            <dl>
                <dt href="javascript:;">
                    <i class="iconfont icon-caiwu1"></i>
                    <cite>财务</cite>
                    <i class="iconfont icon-angle-down"></i>
                </dt>
                <dd>
                    <a href="">资金管理</a>
                    <a href="">提现申请</a>
                    <a href="">发票管理</a>
                </dd>
            </dl>
            <dl>
                <dt href="javascript:;">
                    <i class="iconfont icon-shezhi"></i>
                    <cite>设置</cite>
                    <i class="iconfont icon-angle-down"></i>
                </dt>
                <dd>
                    <a href="">常用信息</a>
                    <a href="">账号信息</a>
                    <a href="">修改密码</a>
                </dd>
            </dl>
        </div>
        <a href="javascript:;" class="btn-side J-btn-side"><i class="iconfont icon-left"></i></a>
    </div>
    <div class="body-con layui-form">
        <div class="body-wrap">
            <div class="ndwz">
                首页 > <a href="">任务管理</a>
            </div>
            <div class="ui-tag-tit">
                <ul>
                    <li><a href="javascript:;" class="on">添加零客</a></li>
                </ul>
            </div>
            <div class="layui-card pd-20">
                <div class="layui-card-body">
                    <div class="ui-tit">
                        <b>基本信息</b>
                    </div>
                    
                    <div class="tips-con mg-t-20">
                        <i class="iconfont icon-tishitubiao"></i>
                        <p>
                            1、仅支持对用户身份证照正反面单独上传，请严格按照系统要求对文件进行命名，命名规则如下。<br>
                            &ensp;&emsp;正面(人像面)命名规则： <span class="c-orange">姓名-手机号-正面</span><br>
                            &ensp;&emsp;反面(国徽面)命名规则： <span class="c-orange">姓名-手机号-反面</span><br>
                            2、请严格按照上述说明对文件命名，否则文件将解析失败
                        </p>
                    </div>

                    <div class="upload-item-con mg-t-20">
                        <div class="layui-upload">
                            <!-- <button type="button" class="layui-btn plain" id="test1">上传图片</button> -->
                            <div class="upload-item" id="test1">
                                <i class="iconfont icon-xinjianmoban"></i>
                                <!-- <i class="iconfont icon-shangchuanmoban"></i> -->
                                <span>点击上传模板</span>
                                <p>支持jpg、jpeg、png等图片格式，每张照片最大支持2M</p>
                            </div>
                            <!-- <input class="layui-upload-file" type="file" accept="" name="file"
                                lay-verify="required" lay-reqText=""> -->
                            <ul class="layui-upload-list" id="upload-list1">
                            </ul>
                        </div>
                        <div class="btn-con mg-t-20">
                            <a href="javascript:;" class="layui-btn plain">返回列表</a>
                            <a href="javascript:;" class="layui-btn btn-normal J-btn-upload">下一步</a>
                        </div>
                    </div>

                </div>

                <div class="layui-card-body layui-hide upload-table-con">
                    <table class="layui-table upload-table mg-t-10" lay-filter="table-list">
                        <thead>
                            <tr>
                                <th width="80">姓名</th>
                                <th width="120">手机号</th>
                                <th width="150">正面</th>
                                <th width="120">反面</th>
                                <th width="">操作</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>

                <div class="sticky-bottom mg-t-20">
                    <div class="layui-input-inline mg-r-20">
                        <i class="iconfont icon-tishi c-orange"></i>&ensp;检验成功 <spna class="c-orange">1</spna> 条，检验失效 <spna class="c-orange">1</spna> 条
                    </div>
                    <a href="javascript:;" class="layui-btn btn-lg btn-normal J-btn-sure">确定导入</a>
                </div>
            </div>
            <!-- <div class="footer-btn">
                <a href="" class="layui-btn btn-lg plain">取消</a>
                <a href="" class="layui-btn btn-lg btn-normal">确认完成</a>
            </div> -->
        </div>
        <!-- <div class="footer-con">
            &copy; Copyright 2020 多多优采&emsp;|&emsp;技术支持：<a>厦门市旅动力信息有限公司</a>
        </div> -->
    </div>

    <script type="text/html" id="tpl-detail-con">
    <div class="txt">
        <p>为商业地产租赁及物业行业提供家政、经纪代理、软件技术服务及匹配的相关装卸搬运、会议会展、企业管理服务内容</p>
        <p>为商业地产租赁及物业行业提供家政、经纪代理、软件技术服务及匹配的相关装卸搬运、会议会展、企业管理服务内容</p>
        <p>为商业地产租赁及物业行业提供家政、经纪代理、软件技术服务及匹配的相关装卸搬运、会议会展、企业管理服务内容</p>
    </div>
</script>
    <script src="static/js/layui/layui.js"></script>
    <script src="static/js/layui/config.js"></script>
    <!-- <script src="static/js/qrcode.min.js"></script> -->

    <script>
        layui.use(['laydate', 'layer', 'table', 'form', 'upload', 'element', 'laytpl', 'tableNav'], function () {
            var $ = layui.jquery
                , laydate = layui.laydate //日期
                , layer = layui.layer //弹层
                , table = layui.table // 表格
                , form = layui.form //表单
                , upload = layui.upload
                , element = layui.element //元素操作
                , laytpl = layui.laytpl
            // , tableNav = layui.tableNav


            var pros_img = '',
                cons_img = '',
                pros_id = '',
                cons_id = ''
            // 上传多图
            upload.render({
                elem: '#test1'
                , url: 'https://httpbin.org/post'
                , auto: false //选择文件后不自动上传
                , multiple: true
                , exts: 'jpg|png|gif|bmp|jpeg'
                , bindAction: '.J-btn-upload' //指向一个按钮触发上传
                , choose: function (obj) {
                    //将每次选择的文件追加到文件队列
                    var files = obj.pushFile();
                    //预读本地文件，如果是多文件，则会遍历。(不支持ie8/9)
                    obj.preview(function (index, file, result) {
                        var names = file.name

                        var n = names.match(/\-+/g)||[]
                        if(n.length != 2){
                            layer.msg('文件名规则错误')
                            delete files[index]
                            return false
                        }


                        // console.log(index); //得到文件索引
                        // console.log(file); //得到文件对象
                        // console.log(result); //得到文件base64编码，比如图片
                        //obj.resetFile(index, file, '123.jpg'); //重命名文件名，layui 2.3.0 开始新增
                        //这里还可以做一些 append 文件列表 DOM 的操作
                        // obj.upload(index, file); //对上传失败的单个文件重新上传，一般在某个事件中使用
                        //delete files[index]; //删除列表中对应的文件，一般在某个事件中使用

                        var name = names.match(/(\S*)-1/)[1].trim(),
                            mobile = names.match(/-(\S*)-/)[1].trim(),
                            texts = names.match(/-(\S*)(.jpg|.png|.jpeg)$/)[1].trim(),
                            nameId = names.match(/(\S*)(.jpg|.png|.jpeg)$/)[1].trim(),
                            text = texts.match(/-(\S*)/)[1].trim()
                            console.log(nameId)
                        var has_name = false
                        if(text == '正面'){
                            pros_img = result
                            pros_id = nameId
                        }else{
                            cons_img = result
                            cons_id = nameId
                        }
                        var len = $('.upload-table tbody tr').length+1

                        // 新增一行数据
                        if($('.upload-table tbody tr').length>0){
                            $('table.layui-table tbody tr').each(function(j,k){
                                var self = $(this),
                                    _mobile = self.find('.mobile').text().trim()
                                //对比手机号是否已存在
                                if(_mobile == mobile){
                                    console.log(1);
                                    has_name = true
                                    if(text == '正面'){
                                        self.find('.pros img').attr('src',pros_img).attr('data-id',pros_id)
                                    }else{
                                        self.find('.cons img').attr('src',cons_img).attr('data-id',cons_id)
                                    }
                                    return false
                                }
                            })
                        }
                        // 没有找到对应的证件照
                        if(has_name == false){
                            console.log(3);
                            if(text == '正面'){
                                pros_img = result
                                cons_img = ''
                                pros_id = nameId
                            }else{
                                cons_img = result
                                pros_img = ''
                                cons_id = nameId
                            }
                            var _html = `<tr>
                                        <td><span class="name">`+name+`</span</td>
                                        <td><span class="mobile">`+mobile+`</span></td>
                                        <td><span class="pros"><img src="`+pros_img+`" data-id="`+pros_id+`"></span></td>
                                        <td><span class="cons"><img src="`+cons_img+`" data-id="`+cons_id+`"></span></td>
                                        <td>
                                            <span><a href="javascript:;" class="J-upload" data-type="pros">上传正面</a></span>&emsp;
                                            <span><a href="javascript:;" class="J-upload" data-type="cons">上传反面</a></span>&emsp;
                                            <a href="javascript:;" class="J-del">删除</a>
                                        </td>
                                    </tr>`
                            $('table.layui-table tbody').append(_html)
                        }

                        // 显示临时图片
                        // console.log(names);
                        // console.log(file);
                        if(!$('#upload-list1 li').length){
                            $('#upload-list1').append('<li><i class="iconfont icon-guanbi2fill"></i><img src="' + result + '" alt="' + file.name + '" class="layui-upload-img"></li>')
                        }else{
                            var has_alt = false
                            $('#upload-list1 li').each(function(){
                                var alt = $(this).find('img').attr('alt')
                                console.log(alt);
                                if(file.name == alt){
                                    has_alt = true
                                }
                            })

                            if(has_alt == false){
                                $('#upload-list1').append('<li><i class="iconfont icon-guanbi2fill"></i><img src="' + result + '" alt="' + file.name + '" class="layui-upload-img"></li>')
                            }
                            // 删除临时图片
                            $('body').on('click', '#upload-list1 i', function () {
                                var self = $(this),
                                    li = self.parents('li')
                                var i = li.index()
                                li.remove()
                                delete files[index];
                            })
                        }
                    });
                    // console.log(files);

                }, done: function (res, index) {
                    
                    // delete files[index];
                }
            });

            $('body').on('click','.J-btn-upload',function(){
                $('.upload-item-con').hide()
                $('.upload-table-con').removeClass('layui-hide')
                
                upload.render({
                    elem: '.J-upload'
                    ,url: 'https://httpbin.org/post' //改成您自己的上传接口
                    ,before: function(obj){
                        //预读本地文件示例，不支持ie8
                        obj.preview(function(index, file, result){
                            // $('#demo1').attr('src', result); //图片链接（base64）
                            console.log(file);
                            var _id = file.name.match(/(\S*)(.jpg|.png|.jpeg)$/)[1].trim()
                            $('.upload-table img[data-id="'+_id+'"]').attr('src',result)
                        });
                    }
                    ,done: function(res){
                
                    }
                    ,error: function(){
                    
                    }
                });
            })

        })

    </script>
</body>

</html>